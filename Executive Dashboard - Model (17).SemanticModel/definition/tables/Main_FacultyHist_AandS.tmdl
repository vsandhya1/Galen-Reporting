table Main_FacultyHist_AandS
	lineageTag: 9a974f74-32ff-42a3-8293-61d1e5aa68bc

	measure AandS_Color =
			
			VAR TermsRankASCY = CALCULATE(Main_FacultyHist_AandS[AandS_AttritionFaculty_Count],REMOVEFILTERS(DIM_Terms), Main_FacultyHist_AandS[TERMS_RANKED] = 1)
			VAR TermsRankASLY = CALCULATE(Main_FacultyHist_AandS[AandS_AttritionFaculty_Count],REMOVEFILTERS(DIM_Terms),Main_FacultyHist_AandS[TERMS_RANKED] = 5)
			RETURN
			SWITCH(TRUE(),TermsRankASCY<TermsRankASLY,"Green",TermsRankASCY>TermsRankASLY,"Red","Black")
		lineageTag: 71f7edf3-3187-4a67-9964-67885395003e

	measure AandS_AttritionFaculty_Count = CALCULATE(DISTINCTCOUNT(Main_FacultyHist_AandS[FACULTY_NUMBER]),Main_FacultyHist_AandS[PREV_TOTAL_ATTR_PERC]>.2)+0
		formatString: 0
		lineageTag: 5392e3e0-4229-4938-a276-93feea0075a1

	measure AandS_AttritionFaculty_Count_Term1 = ```
			
			CALCULATE(
			    [AandS_AttritionFaculty_Count],
			    DIM_Terms[FACULTYATTRITIONTERMS] = 1
			)
			
			```
		formatString: 0
		lineageTag: cc30057f-a944-485e-88dc-ae63ff197044

	measure AandS_AttritionFaculty_Count_Term5 = ```
			
			CALCULATE(
			    [AandS_AttritionFaculty_Count],
			    DIM_Terms[FACULTYATTRITIONTERMS] = 5
			)
			
			```
		formatString: 0
		lineageTag: cbd16328-2c75-40d5-a5d7-ca46d2ef073d

	measure AandS_Compare_Font_Color = ```
			
			IF (
			    [AandS_AttritionFaculty_Count_Term1] < [AandS_AttritionFaculty_Count_Term5],
			    "Green",
			    "Red"
			)
			
			```
		lineageTag: d2cbab73-25a3-4e17-8347-715ea880b9d5

	column STC_TERM
		dataType: string
		lineageTag: c5976af0-8938-41d0-885b-3be4995237bd
		summarizeBy: none
		sourceColumn: STC_TERM

		annotation SummarizationSetBy = Automatic

	column ATTR_STC_TERM
		dataType: string
		lineageTag: 1c342204-a896-4648-b642-8493582886d5
		summarizeBy: none
		sourceColumn: ATTR_STC_TERM

		annotation SummarizationSetBy = Automatic

	column STC_COURSE_NAME
		dataType: string
		lineageTag: 5c936a8a-26e3-462c-ac2f-161ae70e7327
		summarizeBy: none
		sourceColumn: STC_COURSE_NAME

		annotation SummarizationSetBy = Automatic

	column FACULTY_NUMBER
		dataType: string
		lineageTag: 87bdbe79-c1e2-47a1-aa70-fe2124d36c72
		summarizeBy: none
		sourceColumn: FACULTY_NUMBER

		annotation SummarizationSetBy = Automatic

	column FACULTY_NAME
		dataType: string
		lineageTag: bb9a5513-fd66-4a4e-8f6d-66404c292ca5
		summarizeBy: none
		sourceColumn: FACULTY_NAME

		annotation SummarizationSetBy = Automatic

	column FAC_TYPE
		dataType: string
		lineageTag: b3981b0f-b90c-4601-9796-614c6b54e3b8
		summarizeBy: none
		sourceColumn: FAC_TYPE

		annotation SummarizationSetBy = Automatic

	column SECTIONS
		dataType: string
		lineageTag: af43e8d1-0ef4-4735-8df7-22e486f32b5d
		summarizeBy: none
		sourceColumn: SECTIONS

		annotation SummarizationSetBy = Automatic

	column MODALITY
		dataType: string
		lineageTag: 21cbecf9-8b0d-4e76-ab0e-b636adab5d7f
		summarizeBy: none
		sourceColumn: MODALITY

		annotation SummarizationSetBy = Automatic

	column COURSE_SECTIONS_ID
		dataType: string
		lineageTag: f36dcb47-ce8b-4935-93b2-6f216767421b
		summarizeBy: none
		sourceColumn: COURSE_SECTIONS_ID

		annotation SummarizationSetBy = Automatic

	column SECTION_COUNT
		dataType: int64
		formatString: 0
		lineageTag: dff4ebb5-e83a-4d14-a081-b5d5be60ae38
		summarizeBy: sum
		sourceColumn: SECTION_COUNT

		annotation SummarizationSetBy = Automatic

	column ENROLLED
		dataType: double
		lineageTag: 7462d6e8-1568-449f-8994-95a1dc038e9e
		summarizeBy: sum
		sourceColumn: ENROLLED

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column PASSED
		dataType: int64
		formatString: 0
		lineageTag: 0ea9d316-3a54-474c-949d-3fb33fa5ec86
		summarizeBy: sum
		sourceColumn: PASSED

		annotation SummarizationSetBy = Automatic

	column FAILED
		dataType: int64
		formatString: 0
		lineageTag: 084457ac-7c35-4822-a9c6-c176aeec328b
		summarizeBy: sum
		sourceColumn: FAILED

		annotation SummarizationSetBy = Automatic

	column FAIL_PERC
		dataType: double
		lineageTag: 3cacfd2d-c289-4f29-be7a-3465568eb273
		summarizeBy: sum
		sourceColumn: FAIL_PERC

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column FAIL_PERC_ROUNDED
		dataType: string
		lineageTag: 939f4c75-edc7-415e-9cab-a36073aa4f42
		summarizeBy: none
		sourceColumn: FAIL_PERC_ROUNDED

		annotation SummarizationSetBy = Automatic

	column DROPPED
		dataType: int64
		formatString: 0
		lineageTag: d22db958-d07d-4058-a852-fa9254ce34c7
		summarizeBy: sum
		sourceColumn: DROPPED

		annotation SummarizationSetBy = Automatic

	column DROP_PERC
		dataType: double
		lineageTag: 6e50ac74-1ed2-436e-ba45-3bb5a857797c
		summarizeBy: sum
		sourceColumn: DROP_PERC

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column DROP_PERC_ROUNDED
		dataType: string
		lineageTag: 696ed6ef-bb4f-46d6-8285-6d443e82b02f
		summarizeBy: none
		sourceColumn: DROP_PERC_ROUNDED

		annotation SummarizationSetBy = Automatic

	column TOTAL_ATTRITION
		dataType: int64
		formatString: 0
		lineageTag: bbb65abf-761f-43b3-aceb-527aefdb452f
		summarizeBy: sum
		sourceColumn: TOTAL_ATTRITION

		annotation SummarizationSetBy = Automatic

	column TOTAL_ATTR_PERC
		dataType: double
		lineageTag: a250a495-031f-47c8-b31f-3bf4143b472a
		summarizeBy: sum
		sourceColumn: TOTAL_ATTR_PERC

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column TOTAL_ATTR_PERC_ROUNDED
		dataType: double
		lineageTag: 9f0cc92b-f80e-41ad-b1dd-76076df372a1
		summarizeBy: sum
		sourceColumn: TOTAL_ATTR_PERC_ROUNDED

		changedProperty = DataType

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column PREV_TOTAL_ATTR_PERC
		dataType: double
		lineageTag: b44241b5-9598-4844-b877-4092725e76f8
		summarizeBy: sum
		sourceColumn: PREV_TOTAL_ATTR_PERC

		annotation SummarizationSetBy = Automatic

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	column TERMS_RANKED
		dataType: int64
		formatString: 0
		lineageTag: 638a4a8a-9c7f-4e25-9ef9-1d32a7e62c09
		summarizeBy: sum
		sourceColumn: TERMS_RANKED

		annotation SummarizationSetBy = Automatic

	column ATTR_STC_TERMS = LEFT([ATTR_STC_TERM],7)
		lineageTag: bd13635f-68ea-47c2-9e0f-06bb8bd53dcc
		summarizeBy: none
		sortByColumn: TERMS_RANKED

		changedProperty = SortByColumn

		annotation SummarizationSetBy = Automatic

	column Campus = "ONL"
		lineageTag: 128a9c36-898e-4ba2-ad07-6487d436de35
		summarizeBy: none

		annotation SummarizationSetBy = Automatic

	partition Main_FacultyHist_AandS = m
		mode: import
		queryGroup: Academics
		source =
				let
				     Source = Sql.Database("rpt2-prod.ec.galencollege.edu", "coll18_repl_production", [Query="#(lf)/*###############################################################################################################################(lf)#(tab)Gathering Student Program information with date ranges for each student that they were active.#(lf)################################################################################################################################*/#(lf)#(lf)#(lf)DROP TABLE IF EXISTS #STUDENT_PROGRAM;#(lf)#(lf)SELECT DISTINCT#(tab)#(lf)SP.STUDENT_PROGRAMS_ID,#(lf)LEFT(SP.STUDENT_PROGRAMS_ID, 7)  AS STUDENT_ID, #(lf)substring(SP.STUDENT_PROGRAMS_ID, 9,30) AS PROGRAM_ID, #(lf)D.STPR_START_DATE, #(lf)D.STPR_END_DATE,#(lf)ROW_NUMBER() OVER(PARTITION BY SP.STUDENT_PROGRAMS_ID ORDER BY D.STPR_START_DATE DESC) AS  MOST_RECENT_PROGRAM,#(lf)SP.STPR_CATALOG,#(lf)SP.STPR_LOCATION#(lf)INTO #STUDENT_PROGRAM#(lf)FROM [coll18_repl_production].dbo.STUDENT_PROGRAMS SP#(lf)LEFT JOIN STPR_DATES D ON SP.STUDENT_PROGRAMS_ID = D.STUDENT_PROGRAMS_ID#(lf)WHERE SUBSTRING(SP.STUDENT_PROGRAMS_ID, 9,30)  NOT IN ('UNDETERMINED')#(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)DROP TABLE IF EXISTS #TEMPDATE;#(lf)#(lf)SELECT STUDENT_PROGRAMS_ID AS SID, #(lf)LEFT(STUDENT_PROGRAMS_ID, 7)  AS STUDENT_ID, #(lf)substring(STUDENT_PROGRAMS_ID, 9,30) AS PROGRAM_ID,#(lf)CAST(STPR_START_DATE AS DATE) AS STPR_START_DATE, CAST(ISNULL(STPR_END_DATE,'12/31/2050') AS DATE)  AS STPR_END_DATE, STPR_LOCATION,#(lf)ROW_NUMBER() OVER (PARTITION BY STUDENT_PROGRAMS_ID  ORDER BY STUDENT_PROGRAMS_ID, POS) AS DATEPOS#(lf)INTO #TEMPDATE#(lf)FROM STPR_DATES#(lf)JOIN ( SELECT DISTINCT STUDENT_PROGRAMS_ID AS SID FROM STPR_STATUSES WHERE STPR_STATUS = 'A') X1 ON X1.SID = STPR_DATES.STUDENT_PROGRAMS_ID#(lf)JOIN (SELECT DISTINCT STUDENT_PROGRAMS_ID AS SID, STPR_LOCATION FROM STUDENT_PROGRAMS) X2 ON X2.SID = STPR_DATES.STUDENT_PROGRAMS_ID#(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)DROP TABLE IF EXISTS #GRAD_STATUS_WITH_DATES;#(lf)#(lf)SELECT SS.STUDENT_PROGRAMS_ID, 'G' AS STPR_STATUS, CAST(STPR_START_DATE AS DATE) AS STPR_START_DATE,  CAST(STPR_END_DATE AS DATE) AS STPR_END_DATE#(lf)INTO #GRAD_STATUS_WITH_DATES#(lf)FROM STPR_STATUSES SS#(lf)JOIN STPR_DATES SD ON SD.STUDENT_PROGRAMS_ID = SS.STUDENT_PROGRAMS_ID AND SD.POS = 1#(lf)WHERE STPR_STATUS = 'G' #(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)DROP TABLE IF EXISTS #PROGRAM_BUCKETS#(lf)#(lf)SELECT #(lf)#(tab)CASE WHEN ProgramTime IS NOT NULL THEN CONCAT(ProgramBucket, ' - ', ProgramTime) ELSE ProgramBucket END AS FULL_PROGRAM_BUCKET,#(lf)#(tab)GENERAL_PROGRAM,#(lf)#(tab)ProgramBucket,#(lf)#(tab)ProgramTime,#(lf)#(tab)ACAD_PROGRAMS_ID#(lf)INTO #PROGRAM_BUCKETS#(lf)FROM (#(lf)#(tab)SELECT #(lf)#(tab)#(tab)CASE#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE 'ADN%' THEN 'ADN'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE 'BSN%' THEN 'BSN'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE '%PN%' OR ACAD_PROGRAMS_ID LIKE '%VN%' THEN 'PN/VN'#(lf)#(tab)#(tab)#(tab)ELSE NULL#(lf)#(tab)#(tab)END AS GENERAL_PROGRAM,#(lf)#(tab)#(tab)CASE#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE 'ADN.BRDG%' OR ACAD_PROGRAMS_ID LIKE 'ADN.ADV%' THEN 'ADN BRIDGE'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE 'ADN.2YR%'  THEN 'ADN 2YR'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID = 'BSN.PRE.BSN' THEN 'BSN Prelicensure'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE '%PN%' THEN 'PN'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE '%VN%' THEN 'VN'#(lf)#(tab)#(tab)END AS ProgramBucket,#(lf)#(tab)#(tab)CASE#(tab)#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE '%DAY%' THEN 'DAY'#(lf)#(tab)#(tab)#(tab)WHEN ACAD_PROGRAMS_ID LIKE '%EVE%' THEN 'EVE'#(lf)#(tab)#(tab)#(tab)ELSE NULL#(lf)#(tab)#(tab)END AS ProgramTime,#(lf)#(tab)#(tab)*#(lf)#(tab)FROM ACAD_PROGRAMS #(lf)#(tab)WHERE 1=1#(tab)#(tab)#(tab)#(lf)#(tab)AND ACPG_TITLE <> 'DO NOT USE' #(lf)#(tab)AND ACAD_PROGRAMS_ID is not null #(lf)) X#(lf)WHERE #(lf)#(tab)ProgramBucket IS NOT NULL#(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)DROP TABLE IF EXISTS #STPR_MAIN  #(lf)#(lf)SELECT #(lf)#(tab)TD.*,#(lf)#(tab)PB.*,#(lf)#(tab)tg.TRGP_CRED_TYPES CredType, #(lf)#(tab)ap.ACPG_ACAD_LEVEL,#(lf)#(tab)ROW_NUMBER() OVER (PARTITION BY TD.STUDENT_ID ORDER BY TD.STPR_END_DATE DESC) RN#(lf)INTO #STPR_MAIN#(lf)FROM #TEMPDATE TD#(lf)LEFT JOIN ACAD_PROGRAMS ap ON TD.PROGRAM_ID = ap.ACAD_PROGRAMS_ID#(tab)#(lf)LEFT JOIN TRANSCRIPT_GROUPINGS_LS tg on tg.TRANSCRIPT_GROUPINGS_ID = ap.ACPG_TRANSCRIPT_GROUPING#(tab)#(lf)JOIN #PROGRAM_BUCKETS PB ON TD.PROGRAM_ID = PB.ACAD_PROGRAMS_ID#(lf)WHERE #(lf)#(tab)TD.STPR_START_DATE <> TD.STPR_END_DATE#(lf)#(lf)#(lf)#(lf)/*###############################################################################################################################(lf)#(tab)Creating a temp table and inserting data to store ADN 2YR versus ADN BRDG class comparisons.  #(lf)#(tab)These are hard coded values that were provided by Tracy Ortelli on 4/12/23 and should not change frequently.#(lf)################################################################################################################################*/#(tab)#(lf)#(lf)DROP TABLE IF EXISTS #ADN_MAPPING#(lf)#(lf)CREATE TABLE #ADN_MAPPING (#(lf)BRIDGE_COURSE VARCHAR(10),#(lf)TWO_YEAR_COURSE VARCHAR(10),#(lf)OH_COURSE VARCHAR(10),#(lf)MERGED_COURSE_NAMES NVARCHAR(52) #(lf))#(lf)#(lf)INSERT INTO #ADN_MAPPING#(lf)VALUES#(lf)('PNS-202','PNS-112',NULL,'BRDG PNS-202 VS 2YR PNS-112'),#(lf)('NUR-168',NULL,NULL,NULL),#(lf)('NUR-210','NUR-210','BSL-101','BRDG NUR-210 VS 2YR NUR-210'),#(lf)('NUR-242','NUR-170',NULL,'BRDG NUR-242 VS 2YR NUR-170'),#(lf)('NUR-253','NUR-256',NULL,'BRDG NUR-253 VS 2YR NUR-256'),#(lf)('NUR-254','NUR-230','NUR-231','BRDG NUR-254 VS 2YR NUR-230'),#(lf)('NUR-265','NUR-265',NULL,'BRDG NUR-265 VS 2YR NUR-265'),#(lf)('NUR-282','NUR-282',NULL,'BRDG NUR-282 VS 2YR NUR-282'),#(lf)('NUR-283','NUR-283',NULL,'BRDG NUR-283 VS 2YR NUR-283'),#(lf)(NULL,'NUR-155',NULL,NULL),#(lf)(NULL,'NUR-257',NULL,NULL)#(lf)#(lf)#(lf)#(lf)/*###############################################################################################################################(lf)#(tab)Main Block of the query targeting student course records per term, joining Program information from above. #(lf)#(tab)Multiple steps were required due to some whacky Student Program data.  Temp table #MAIN_PRELIM is capturing the data as #(lf)#(tab)intended but a handful of students have courses in terms outside of their active program date ranges. The rest is to try #(lf)#(tab)and capture the missing program info as much as possible.#(lf)################################################################################################################################*/#(tab)#(lf)#(lf)DROP TABLE IF EXISTS #MAIN_PRELIM #(lf)#(lf)SELECT#(lf)#(tab)SAC.STC_PERSON_ID,#(lf)#(tab)P.FIRST_NAME,#(lf)#(tab)P.LAST_NAME,#(lf)#(tab)T.TERMS_ID,#(lf)#(tab)T.TERM_START_DATE,#(lf)#(tab)T.TERM_END_DATE,#(lf)#(tab)SAC.STC_COURSE_NAME,#(lf)#(tab)CASE#(lf)#(tab)#(tab)WHEN SAC.STC_SUBJECT = 'NU' AND SUBSTRING(SAC.STC_SECTION_NO,3,1) = 'D' THEN CONCAT(SAC.STC_COURSE_NAME, ' - Day')#(lf)#(tab)#(tab)WHEN SAC.STC_SUBJECT = 'NU' AND  SUBSTRING(SAC.STC_SECTION_NO,3,1) = 'E' THEN CONCAT(SAC.STC_COURSE_NAME, ' - Eve')#(lf)#(tab)#(tab)WHEN AM.OH_COURSE COLLATE SQL_Latin1_General_CP1_CI_AS IS NOT NULL THEN AM.TWO_YEAR_COURSE COLLATE SQL_Latin1_General_CP1_CI_AS#(lf)#(tab)#(tab)ELSE SAC.STC_COURSE_NAME#(lf)#(tab)END AS STC_COURSE_NAME_CALC,#(lf)#(tab)SAC.STC_SUBJECT,#(lf)#(tab)SAC.STC_SECTION_NO,#(lf)#(tab)CS.COURSE_SECTIONS_ID,#(lf)#(tab)CONCAT(SAC.STC_COURSE_NAME, '-',SAC.STC_SECTION_NO) AS COURSE_WITH_SEC,#(lf)#(tab)SAC.STC_TITLE,#(lf)#(tab)CASE#(lf)#(tab)#(tab)WHEN SAC.STC_SUBJECT = 'NU' AND SUBSTRING(SAC.STC_SECTION_NO,3,1) = 'D' THEN 'Day'#(lf)#(tab)#(tab)WHEN SAC.STC_SUBJECT = 'NU' AND SUBSTRING(SAC.STC_SECTION_NO,3,1) = 'E' THEN 'Eve'#(lf)#(tab)#(tab)ELSE ' '#(lf)#(tab)END AS COURSE_TIME,#(lf)#(tab)CASE#(lf)#(tab)#(tab)WHEN RIGHT(SAC.STC_COURSE_NAME,1) IN ('L','C') THEN 1 #(lf)#(tab)#(tab)ELSE 0 #(lf)#(tab)END AS LAB_CLIN_FLAG,#(lf)#(tab)CASE#(lf)#(tab)#(tab)WHEN SAC.STC_SUBJECT IN ('PNS','NUR','NSG','NU','LDR') OR SAC.STC_COURSE_NAME = 'BSL-101' THEN 1#(lf)#(tab)#(tab)ELSE 0#(lf)#(tab)END AS NURSING_CRS_FLAG,#(lf)#(tab)CS.SEC_FACULTY_INFO,#(lf)#(tab)S.STC_STATUS,#(lf)#(tab)S.POS,#(lf)#(tab)S.STC_STATUS_DATE,#(lf)#(tab)DATEADD(DAY,7,SAC.STC_START_DATE) AS ADD_DROP_DATE,#(lf)#(tab)SAC.STUDENT_ACAD_CRED_ADDDATE,#(lf)#(tab)SAC.STUDENT_ACAD_CRED_CHGDATE,#(lf)#(tab)SAC.STC_VERIFIED_GRADE_DATE,#(lf)#(tab)SAC.STC_ATT_CRED,#(lf)#(tab)SAC.STC_CMPL_CRED,#(lf)#(tab)CS.SEC_LOCATION,#(lf)#(tab)SCS.SCS_LOCATION,#(lf)#(tab)SP.STPR_LOCATION,#(lf)#(tab)CASE #(lf)#(tab)#(tab)WHEN CS.SEC_LOCATION IS NOT NULL THEN CS.SEC_LOCATION#(lf)#(tab)#(tab)WHEN SCS.SCS_LOCATION IS NOT NULL THEN SCS.SCS_LOCATION#(lf)#(tab)#(tab)WHEN SP.STPR_LOCATION IS NOT NULL THEN SP.STPR_LOCATION#(lf)#(tab)#(tab)ELSE NULL#(lf)#(tab)END AS COURSE_LOCATION,#(lf)#(tab)CASE #(lf)#(tab)#(tab)WHEN CS.SEC_LOCATION IS NOT NULL THEN CS.SEC_LOCATION#(lf)#(tab)#(tab)WHEN SCS.SCS_LOCATION IS NOT NULL THEN SCS.SCS_LOCATION#(lf)#(tab)#(tab)WHEN SP.STPR_LOCATION IS NOT NULL THEN SP.STPR_LOCATION#(lf)#(tab)#(tab)ELSE NULL#(lf)#(tab)END AS COURSE_LOCATION_CALC,#(lf)#(tab)SP.PROGRAM_ID,#(lf)#(tab)SP.GENERAL_PROGRAM,#(lf)#(tab)SP.FULL_PROGRAM_BUCKET,#(lf)#(tab)SP.ProgramBucket,#(lf)#(tab)SP.ProgramTime,#(lf)#(tab)SP.STPR_START_DATE,#(lf)#(tab)SP.STPR_END_DATE,#(lf)#(tab)CASE WHEN SP.PROGRAM_ID IS NULL THEN 1 ELSE NULL END AS PRGM_LOGIC_IS_FLG,#(lf)#(tab)AM.BRIDGE_COURSE,#(lf)#(tab)AM.TWO_YEAR_COURSE,#(lf)#(tab)AM.OH_COURSE,#(lf)#(tab)AM.MERGED_COURSE_NAMES,#(lf)#(tab)FGL.GRD_GRADE AS VERIFIED_FINAL_LETTER_GRADE,#(lf)#(tab)FGL.GRD_LEGEND AS VERIFIED_FINAL_LETTER_LEGEND,#(lf)#(tab)FGN.GRD_GRADE AS VERIFIED_FINAL_NUM_GRADE,#(lf)#(tab)FGN.GRD_LEGEND AS VERIFIED_FINAL_NUM_LEGEND,#(lf)#(tab)MG.GRD_GRADE AS MIDTERM_NUM_GRADE,#(lf)#(tab)MG.GRD_LEGEND AS MIDTERM_NUM_LEGEND,#(lf)#(tab)CASE WHEN FGL.GRD_GRADE IN ('A+','A','A-','B+','B','B-','C+','C','C-','S') THEN 1 ELSE 0 END AS PASSED,#(lf)#(tab)CASE WHEN FGL.GRD_GRADE IN ('F','I','U') THEN 1 ELSE 0 END AS FAILED,#(lf)#(tab)CASE WHEN FGL.GRD_GRADE IN ('W','WP','WF','DP','DF')  THEN 1  WHEN S.STC_STATUS IN ('D','W') AND DATEDIFF(DAY,CS.SEC_START_DATE, S.STC_STATUS_DATE) >= 7 THEN 1 ELSE 0 END AS DROPPED,#(lf)#(tab)CAST(1 AS DECIMAL) AS ENROLLED,#(lf)#(tab)CS.SEC_NO,#(lf)#(tab)CASE WHEN TRY_CONVERT(INT, CS.SEC_NO) IS NOT NULL THEN 'Online' WHEN SUBSTRING(CS.SEC_NO,3,1) IN ('M','N') THEN 'Virtual' ELSE 'Ground' END AS MODALITY#(lf)INTO #MAIN_PRELIM#(lf)FROM #(lf)#(tab)STUDENT_ACAD_CRED SAC#(lf)JOIN PERSON P ON SAC.STC_PERSON_ID = P.ID#(lf)LEFT JOIN STUDENT_COURSE_SEC SCS ON SAC.STUDENT_ACAD_CRED_ID =  SCS.SCS_STUDENT_ACAD_CRED#(lf)LEFT JOIN COURSE_SECTIONS CS ON SCS.SCS_COURSE_SECTION = CS.COURSE_SECTIONS_ID#(lf)LEFT JOIN COURSES C ON CS.SEC_COURSE = C.COURSES_ID#(lf)LEFT JOIN GRADES MG ON SCS.SCS_MID_TERM_GRADE1 = MG.GRADES_ID --(MID TERM GRADE JOIN)#(lf)LEFT JOIN GRADES FGL ON SAC.STC_VERIFIED_GRADE = FGL.GRADES_ID --(FINAL GRADE LETTER JOIN)#(lf)LEFT JOIN GRADES FGN ON SAC.STC_FINAL_GRADE = FGN.GRADES_ID --(FINAL GRADE NUMERIC JOIN)#(lf)JOIN STC_STATUSES S ON SAC.STUDENT_ACAD_CRED_ID = S.STUDENT_ACAD_CRED_ID AND S.POS = 1#(lf)JOIN CRED_TYPES CT ON SAC.STC_CRED_TYPE = CT.CRED_TYPES_ID#(lf)LEFT JOIN #STPR_MAIN SP on SP.STUDENT_ID = SAC.STC_PERSON_ID AND CT.CRED_TYPES_ID = SP.CredType AND SAC.STC_ACAD_LEVEL = SP.ACPG_ACAD_LEVEL AND SAC.STC_START_DATE >= SP.STPR_START_DATE AND SAC.STC_START_DATE <= SP.STPR_END_DATE#(lf)LEFT JOIN #ADN_MAPPING AM ON (SAC.STC_COURSE_NAME = AM.BRIDGE_COURSE COLLATE SQL_Latin1_General_CP1_CI_AS OR SAC.STC_COURSE_NAME = AM.TWO_YEAR_COURSE COLLATE SQL_Latin1_General_CP1_CI_AS OR SAC.STC_COURSE_NAME = AM.OH_COURSE COLLATE SQL_Latin1_General_CP1_CI_AS)#(lf)JOIN (SELECT TOP 8 TERMS_ID, TERM_START_DATE, TERM_END_DATE #(lf)#(tab)#(tab)FROM TERMS#(lf)#(tab)#(tab)WHERE 1 = 1 #(lf)#(tab)#(tab)AND DATEADD(WEEK,2,TERM_START_DATE) <= GETDATE()#(lf)#(tab)#(tab)AND RIGHT(TERMS_ID,1) = 'Q'#(lf)#(tab)#(tab)ORDER BY TERM_START_DATE DESC) T ON SAC.STC_TERM = T.TERMS_ID#(lf)--JOIN TERMS T ON SAC.STC_TERM = T.TERMS_ID LB#(lf)WHERE  1=1#(lf)--AND (SAC.STC_TERM LIKE CONCAT(DATEPART(YEAR,GETDATE()),'%Q') OR SAC.STC_TERM LIKE CONCAT(DATEPART(YEAR,DATEADD(YEAR,-1,GETDATE())),'%Q')) LB#(lf)--AND GETDATE() NOT BETWEEN T.TERM_START_DATE AND T.TERM_END_DATE LB#(lf)--AND SAC.STC_START_DATE < DATEADD(WEEK,2,GETDATE()) LB#(lf)AND CASE WHEN (S.STC_STATUS IN('D','W') AND S.STC_STATUS_DATE <= SAC.STC_START_DATE) OR (S.STC_STATUS IN ('D','W') AND DATEDIFF(DAY,CS.SEC_START_DATE, S.STC_STATUS_DATE) <= 7) THEN 1 ELSE 0 END <> 1#(lf)AND S.STC_STATUS NOT IN ('X','DR','T','TR')#(lf)#(lf)#(lf)/*###############################################################################################################################(lf)#(tab)This section is looking at records from #main_prelim that have null program information.  #(lf)#(tab)They have null program information due to the term start date falling outside of a program start date and end date range #(lf)#(tab)that should be associated with the student. The queries below are extracting the closest previous program to the #(lf)#(tab)student with the start of the term.#(lf)################################################################################################################################*/#(tab)#(lf)#(lf)DROP TABLE IF EXISTS #NULL_PROGRAM_STUDENTS#(lf)#(lf)SELECT DISTINCT#(lf)STC_PERSON_ID, TERM_START_DATE#(lf)INTO #NULL_PROGRAM_STUDENTS#(lf)FROM #(lf)#(tab)#MAIN_PRELIM#(lf)WHERE PROGRAM_ID IS NULL#(lf)#(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)DROP TABLE IF EXISTS #CORRECT_NULL_PROGRAM_STUDENTS#(lf)SELECT DISTINCT#(lf)#(tab)X1.STC_PERSON_ID,#(lf)#(tab)X1.TERM_START_DATE,#(lf)#(tab)X1.PROGRAM_ID,#(lf)#(tab)PB.GENERAL_PROGRAM,#(lf)#(tab)PB.FULL_PROGRAM_BUCKET,#(lf)#(tab)PB.ProgramBucket,#(lf)#(tab)PB.ProgramTime,#(lf)#(tab)X1.STPR_LOCATION#(lf)INTO #CORRECT_NULL_PROGRAM_STUDENTS#(lf)FROM (#(lf)#(tab)#(tab)SELECT #(lf)#(tab)#(tab)#(tab)NPS.STC_PERSON_ID,#(lf)#(tab)#(tab)#(tab)SUBSTRING(SP.STUDENT_PROGRAMS_ID, 9,30) AS PROGRAM_ID,#(lf)#(tab)#(tab)#(tab)SP.STPR_LOCATION,#(lf)#(tab)#(tab)#(tab)SD.STPR_START_DATE,#(lf)#(tab)#(tab)#(tab)SD.STPR_END_DATE,#(lf)#(tab)#(tab)#(tab)NPS.TERM_START_DATE,#(lf)#(tab)#(tab)#(tab)DATEDIFF(DAY,ISNULL(SD.STPR_END_DATE,GETDATE()),NPS.TERM_START_DATE) AS DATE_CHECK,#(lf)#(tab)#(tab)#(tab)ROW_NUMBER() OVER (PARTITION BY NPS.STC_PERSON_ID ORDER BY SD.STPR_START_DATE) PGRM_RN#(lf)#(tab)#(tab)FROM #(lf)#(tab)#(tab)#(tab)#NULL_PROGRAM_STUDENTS NPS#(lf)#(tab)#(tab)JOIN STUDENT_PROGRAMS SP ON NPS.STC_PERSON_ID = LEFT(SP.STUDENT_PROGRAMS_ID,7)#(lf)#(tab)#(tab)JOIN STPR_DATES SD ON LEFT(SP.STUDENT_PROGRAMS_ID,7) = LEFT(SD.STUDENT_PROGRAMS_ID,7) AND SUBSTRING(SP.STUDENT_PROGRAMS_ID, 9,30) = SUBSTRING(SD.STUDENT_PROGRAMS_ID, 9,30) AND SD.POS = 1#(lf)#(tab)) X1#(lf)JOIN (#(lf)#(tab)SELECT #(lf)#(tab)#(tab)NPS.STC_PERSON_ID,#(lf)#(tab)#(tab)MIN(DATEDIFF(DAY,ISNULL(SD.STPR_END_DATE,GETDATE()),NPS.TERM_START_DATE)) AS MIN_DATE_CHECK,#(lf)#(tab)#(tab)NPS.TERM_START_DATE#(lf)#(tab)FROM #(lf)#(tab)#(tab)#NULL_PROGRAM_STUDENTS NPS#(lf)#(tab)JOIN STUDENT_PROGRAMS SP ON NPS.STC_PERSON_ID = LEFT(SP.STUDENT_PROGRAMS_ID,7)#(lf)#(tab)JOIN STPR_DATES SD ON LEFT(SP.STUDENT_PROGRAMS_ID,7) = LEFT(SD.STUDENT_PROGRAMS_ID,7) AND SUBSTRING(SP.STUDENT_PROGRAMS_ID, 9,30) = SUBSTRING(SD.STUDENT_PROGRAMS_ID, 9,30) AND SD.POS = 1#(lf)#(tab)WHERE DATEDIFF(DAY,ISNULL(SD.STPR_END_DATE,GETDATE()),NPS.TERM_START_DATE) >= 0#(lf)#(tab)GROUP BY #(lf)#(tab)#(tab)NPS.STC_PERSON_ID,#(lf)#(tab)#(tab)NPS.TERM_START_DATE#(lf)) X2 ON X1.STC_PERSON_ID = X2.STC_PERSON_ID AND X1.TERM_START_DATE = X2.TERM_START_DATE AND X1.DATE_CHECK = X2.MIN_DATE_CHECK#(lf)LEFT JOIN #PROGRAM_BUCKETS PB ON X1.PROGRAM_ID = PB.ACAD_PROGRAMS_ID#(lf)#(lf)#(lf)/*##################################################################################################################################################(lf)#(tab)Final step of the standard query is combining the students with missing program information and is joining to the corrected program info.#(lf)###################################################################################################################################################*/#(lf)#(lf)#(lf)DROP TABLE IF EXISTS #MAIN#(lf)SELECT #(lf)#(tab)MP.STC_PERSON_ID,#(lf)#(tab)MP.FIRST_NAME,#(lf)#(tab)MP.LAST_NAME,#(lf)#(tab)MP.TERMS_ID AS STC_TERM,#(lf)#(tab)MP.TERM_START_DATE AS STC_TERM_START,#(lf)#(tab)MP.TERM_END_DATE,#(lf)#(tab)MP.STC_COURSE_NAME,#(lf)#(tab)MP.STC_COURSE_NAME_CALC,#(lf)#(tab)MP.STC_SUBJECT,#(lf)#(tab)MP.STC_SECTION_NO,#(lf)#(tab)MP.COURSE_SECTIONS_ID,#(lf)#(tab)MP.COURSE_WITH_SEC,#(lf)#(tab)MP.STC_TITLE,#(lf)#(tab)MP.COURSE_TIME,#(lf)#(tab)MP.LAB_CLIN_FLAG,#(lf)#(tab)MP.NURSING_CRS_FLAG,#(lf)#(tab)SEC_FACULTY_INFO,#(lf)#(tab)MP.ADD_DROP_DATE,#(lf)#(tab)MP.STUDENT_ACAD_CRED_ADDDATE,#(lf)#(tab)MP.STUDENT_ACAD_CRED_CHGDATE,#(lf)#(tab)MP.STC_VERIFIED_GRADE_DATE,#(lf)#(tab)MP.STC_ATT_CRED,#(lf)#(tab)MP.STC_CMPL_CRED,#(lf)#(tab)MP.SEC_LOCATION,#(lf)#(tab)MP.SCS_LOCATION,#(lf)#(tab)MP.STPR_LOCATION,#(lf)#(tab)MP.COURSE_LOCATION,#(lf)#(tab)MP.COURSE_LOCATION_CALC,#(lf)#(tab)CASE WHEN MP.PROGRAM_ID IS NULL THEN NPS.PROGRAM_ID ELSE MP.PROGRAM_ID END AS PROGRAM_ID,#(lf)#(tab)CASE WHEN MP.GENERAL_PROGRAM IS NULL THEN NPS.GENERAL_PROGRAM ELSE MP.GENERAL_PROGRAM END AS GENERAL_PROGRAM,#(lf)#(tab)CASE WHEN MP.FULL_PROGRAM_BUCKET IS NULL THEN NPS.FULL_PROGRAM_BUCKET ELSE MP.FULL_PROGRAM_BUCKET END AS FULL_PROGRAM_BUCKET,#(lf)#(tab)CASE WHEN MP.ProgramBucket IS NULL THEN NPS.ProgramBucket ELSE MP.ProgramBucket END AS ProgramBucket,#(lf)#(tab)CASE WHEN MP.ProgramTime IS NULL THEN NPS.ProgramTime ELSE MP.ProgramTime END AS ProgramTime,#(lf)#(tab)MP.STPR_START_DATE,#(lf)#(tab)MP.STPR_END_DATE,#(lf)#(tab)MP.PRGM_LOGIC_IS_FLG,#(lf)#(tab)MP.BRIDGE_COURSE,#(lf)#(tab)MP.TWO_YEAR_COURSE,#(lf)#(tab)MP.OH_COURSE,#(lf)#(tab)MP.MERGED_COURSE_NAMES,#(lf)#(tab)MP.VERIFIED_FINAL_LETTER_GRADE,#(lf)#(tab)MP.VERIFIED_FINAL_LETTER_LEGEND,#(lf)#(tab)MP.VERIFIED_FINAL_NUM_GRADE,#(lf)#(tab)MP.VERIFIED_FINAL_NUM_LEGEND,#(lf)#(tab)MP.MIDTERM_NUM_GRADE,#(lf)#(tab)MP.MIDTERM_NUM_LEGEND,#(lf)#(tab)MP.PASSED,#(lf)#(tab)MP.FAILED,#(lf)#(tab)MP.DROPPED,#(lf)#(tab)MP.ENROLLED,#(lf)#(tab)MP.MODALITY#(lf)INTO #MAIN#(lf)FROM #(lf)#(tab)#MAIN_PRELIM MP#(lf)LEFT JOIN #CORRECT_NULL_PROGRAM_STUDENTS NPS ON MP.STC_PERSON_ID = NPS.STC_PERSON_ID AND MP.TERM_START_DATE = NPS.TERM_START_DATE#(lf)WHERE #(lf)#(tab)(MP.PROGRAM_ID IS NOT NULL OR NPS.PROGRAM_ID IS NOT NULL)#(lf)#(tab)#(lf)#(lf)#(lf)#(lf)---------------------------------------------------------------------------------------------------------------------------------------------------#(lf)#(lf)#(lf)/*###############################################################################################################################(lf)Additional logic from main query to aggregrate by term, campus, program, course, then primary instructor. **Note: If there are multiple primary instructors,#(lf)#(tab)student attrition numbers will be duplicated.**#(lf)#(tab)Also re-joining multiple times to target previous semesters.#(lf)################################################################################################################################*/#(lf)#(lf)#(lf)/*##################################################################(lf)#(tab)Initial Aggregration at course-sec level#(lf)###################################################################*/#(lf)#(lf)DROP TABLE IF EXISTS #MAIN_AGGED#(lf)SELECT #(lf)#(tab)M.STC_TERM,#(lf)#(tab)M.STC_TERM_START,#(lf)#(tab)DENSE_RANK() OVER (ORDER BY M.STC_TERM_START DESC) AS TERMS_RANKED,#(lf)#(tab)M.STC_COURSE_NAME,#(lf)#(tab)M.COURSE_WITH_SEC,#(lf)#(tab)M.STC_SECTION_NO,#(lf)#(tab)M.COURSE_SECTIONS_ID,#(lf)#(tab)M.MODALITY,#(lf)#(tab)--M.COURSE_LOCATION_CALC,#(lf)#(tab)--M.FULL_PROGRAM_BUCKET,#(lf)#(tab)SUM(M.PASSED) AS PASSED,#(lf)#(tab)SUM(M.FAILED) AS FAILED,#(lf)#(tab)SUM(M.DROPPED) AS DROPPED,#(lf)#(tab)SUM(ENROLLED) AS ENROLLED#(lf)INTO #MAIN_AGGED#(lf)FROM #MAIN M#(lf)WHERE #(lf)#(tab)NURSING_CRS_FLAG = 0#(lf)AND LAB_CLIN_FLAG = 0 #(lf)AND STC_SUBJECT <> 'GLN'#(lf)GROUP BY#(lf)#(tab)M.STC_TERM,#(lf)#(tab)M.STC_TERM_START,#(lf)#(tab)M.STC_COURSE_NAME,#(lf)#(tab)M.COURSE_WITH_SEC,#(lf)#(tab)M.STC_SECTION_NO,#(lf)#(tab)M.COURSE_SECTIONS_ID,#(lf)#(tab)M.MODALITY#(lf)#(tab)--M.COURSE_LOCATION_CALC#(lf)#(tab)--M.FULL_PROGRAM_BUCKET#(lf)#(lf)--SELECT DISTINCT STC_TERM FROM #MAIN_AGGED#(lf)#(lf)#(lf)/*###############################################################################################################################(lf)#(tab)Final Agg grouping 1 or more sections per professor per term.#(lf)################################################################################################################################*/#(lf)#(lf)DROP TABLE IF EXISTS #NEW_MAIN#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)INTO #NEW_MAIN#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 1#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 2#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 3#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 4#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(tab)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 5#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 6#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 7#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(lf)#(lf)UNION ALL#(lf)#(lf)SELECT #(lf)#(tab)MA.STC_TERM,#(lf)#(tab)CONCAT(MA.STC_TERM, ' Attr %') as ATTR_STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY AS FACULTY_NUMBER,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME) AS FACULTY_NAME,#(lf)#(tab)CASE WHEN MIN(PLS.GROUPS) LIKE '%ft' THEN 'full-time' WHEN MIN(PLS.GROUPS) LIKE '%pt' THEN 'part-time' WHEN MIN(PLS.GROUPS) LIKE '%prn' THEN 'part-time' ELSE NULL END AS FAC_TYPE,#(lf)#(tab)STRING_AGG(MA.STC_SECTION_NO,' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS SECTIONS, #(lf)#(tab)STRING_AGG(MA.MODALITY, ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) AS MODALITY,#(lf)#(tab)STRING_AGG(CAST(COURSE_SECTIONS_ID as varchar(8)), ' || ') WITHIN GROUP (ORDER BY MA.STC_SECTION_NO) COURSE_SECTIONS_ID,#(lf)#(tab)COUNT(*) AS SECTION_COUNT,#(lf)#(tab)SUM(MA.ENROLLED) AS ENROLLED,#(lf)#(tab)SUM(MA.PASSED) AS PASSED,#(lf)#(tab)SUM(MA.FAILED) AS FAILED,#(lf)#(tab)CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS FAIL_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS FAIL_PERC_ROUNDED,#(lf)#(tab)SUM(MA.DROPPED) AS DROPPED,#(lf)#(tab)CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) AS DROP_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(MA.ENROLLED) AS DECIMAL) *100)/100,5),4) AS DROP_PERC_ROUNDED,#(lf)#(tab)SUM(MA.FAILED) + SUM(MA.DROPPED) AS TOTAL_ATTRITION,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS TOTAL_ATTR_PERC,#(lf)#(tab)LEFT(ROUND(CEILING(CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) *100)/100,5),4) AS TOTAL_ATTR_PERC_ROUNDED,#(lf)#(tab)CAST(SUM(MA.FAILED) + SUM(MA.DROPPED) AS DECIMAL) / CAST(SUM(ENROLLED) AS DECIMAL) AS PREV_TOTAL_ATTR_PERC,#(lf)#(tab)MA.TERMS_RANKED#(lf)FROM #(lf)#(tab)#MAIN_AGGED MA#(lf)LEFT JOIN COURSE_SEC_FACULTY CSF ON MA.COURSE_SECTIONS_ID = CSF.CSF_COURSE_SECTION AND CSF.CSF_TEACHING_ARRANGEMENT IN ('P','H')#(lf)LEFT JOIN PERSON P ON CSF.CSF_FACULTY = P.ID#(lf)LEFT JOIN VALS VF ON TRIM(CSF.CSF_TEACHING_ARRANGEMENT) = TRIM(VF.VAL_INTERNAL_CODE) AND VF.VALCODE_ID = 'TEACHING.ARRANGEMENTS'#(lf)LEFT JOIN PERSON_LS PLS ON P.ID = PLS.ID AND PLS.GROUPS IN ('Stat=ft','Stat=pt','Stat=prn')#(lf)#(lf)WHERE#(lf)#(tab)MA.TERMS_RANKED = 8#(lf)GROUP BY#(lf)#(tab)MA.STC_TERM,#(lf)#(tab)MA.STC_COURSE_NAME,#(lf)#(tab)--MA.COURSE_LOCATION_CALC,#(lf)#(tab)CSF.CSF_FACULTY,#(lf)#(tab)CONCAT(P.LAST_NAME,', ', P.FIRST_NAME),#(lf)#(tab)--PLS.GROUPS,#(lf)#(tab)MA.TERMS_RANKED#(lf)#(tab)#(lf)DROP TABLE IF EXISTS #STUDENT_PROGRAM#(lf)DROP TABLE IF EXISTS #TEMPSTAT#(lf)DROP TABLE IF EXISTS #ACTIVE_STATUS_WITH_DATES#(lf)DROP TABLE IF EXISTS #STPR_STATUS_HIST#(lf)DROP TABLE IF EXISTS #PROGRAM_BUCKETS#(lf)DROP TABLE IF EXISTS #STPR_MAIN#(lf)DROP TABLE IF EXISTS #ADN_MAPPING#(lf)DROP TABLE IF EXISTS #MAIN_PRELIM#(lf)DROP TABLE IF EXISTS #NULL_PROGRAM_STUDENTS#(lf)DROP TABLE IF EXISTS #CORRECT_NULL_PROGRAM_STUDENTS#(lf)DROP TABLE IF EXISTS #MAIN#(lf)DROP TABLE IF EXISTS #MAIN_AGGED#(lf)#(lf)#(lf)SELECT * #(lf)FROM #NEW_MAIN"]),
				    #"Changed Type" = Table.TransformColumnTypes(Source,{{"TOTAL_ATTR_PERC_ROUNDED", Currency.Type}})
				in
				    #"Changed Type"

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

